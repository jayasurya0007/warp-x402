# Avalanche Wrap-x402 Testing Guide

## Current Deployment (Tasks 1 & 2 Tested and Working)

### Network Information
- Subnet A RPC: http://127.0.0.1:9652/ext/bc/bjoxQvUZv6FcN5SyYosFMziVyCcnbRMi2YTr2vX3rFzaYYJn/rpc
- Subnet B RPC: http://127.0.0.1:9650/ext/bc/2fEmFBdd2Dfjh6nmrTjGTGNbnCb86moNHvCtrdP5bJxpftSEXA/rpc
- Subnet A Blockchain ID (CB58): bjoxQvUZv6FcN5SyYosFMziVyCcnbRMi2YTr2vX3rFzaYYJn
- Subnet B Blockchain ID (CB58): 2fEmFBdd2Dfjh6nmrTjGTGNbnCb86moNHvCtrdP5bJxpftSEXA
- Subnet B Blockchain ID (Hex): 0xda84bf13c2354aab48b684d7a177e14a91fb86bdada0e84361e30f6465f3b47b

### Deployed Contracts
- WarpReceiver (Subnet B): 0x52C84043CD9c865236f11d9Fc9F56aa003c1f922
- WarpSender (Subnet A): 0x52C84043CD9c865236f11d9Fc9F56aa003c1f922
- Private Key: 0x56289e99c94b6912bfc12adc093c9b51124f0dc54ac7a766b2bc5ccf558d8027
- Teleporter Messenger: 0x253b2784c75e510dD0fF1da844684a1aC0aa5fcf

## Quick Test Commands

### 1. Send Payment
```bash
PAYMENT_ID=$(cast keccak "test-payment-$(date +%s)")
cast send 0x52C84043CD9c865236f11d9Fc9F56aa003c1f922 "sendPayment(bytes32)" $PAYMENT_ID \
  --value 1000000000000000000 \
  --private-key 0x56289e99c94b6912bfc12adc093c9b51124f0dc54ac7a766b2bc5ccf558d8027 \
  --rpc-url http://127.0.0.1:9652/ext/bc/bjoxQvUZv6FcN5SyYosFMziVyCcnbRMi2YTr2vX3rFzaYYJn/rpc
```

### 2. Wait for ICM Relayer
```bash
sleep 10
```

### 3. Verify Payment
```bash
cast call 0x52C84043CD9c865236f11d9Fc9F56aa003c1f922 "hasPaid(bytes32)(bool)" $PAYMENT_ID \
  --rpc-url http://127.0.0.1:9650/ext/bc/2fEmFBdd2Dfjh6nmrTjGTGNbnCb86moNHvCtrdP5bJxpftSEXA/rpc
```

### 4. Get Payment Receipt
```bash
cast call 0x52C84043CD9c865236f11d9Fc9F56aa003c1f922 \
  "getReceipt(bytes32)((bytes32,uint256,address,uint256,bool))" $PAYMENT_ID \
  --rpc-url http://127.0.0.1:9650/ext/bc/2fEmFBdd2Dfjh6nmrTjGTGNbnCb86moNHvCtrdP5bJxpftSEXA/rpc
```

### 5. Consume Payment
```bash
cast send 0x52C84043CD9c865236f11d9Fc9F56aa003c1f922 "consumePayment(bytes32)" $PAYMENT_ID \
  --private-key 0x56289e99c94b6912bfc12adc093c9b51124f0dc54ac7a766b2bc5ccf558d8027 \
  --rpc-url http://127.0.0.1:9650/ext/bc/2fEmFBdd2Dfjh6nmrTjGTGNbnCb86moNHvCtrdP5bJxpftSEXA/rpc
```

### 6. Set Required Payment Amount
```bash
cast send 0x52C84043CD9c865236f11d9Fc9F56aa003c1f922 \
  "setRequiredPaymentAmount(uint256)" 2000000000000000000 \
  --private-key 0x56289e99c94b6912bfc12adc093c9b51124f0dc54ac7a766b2bc5ccf558d8027 \
  --rpc-url http://127.0.0.1:9650/ext/bc/2fEmFBdd2Dfjh6nmrTjGTGNbnCb86moNHvCtrdP5bJxpftSEXA/rpc
```

## Deployment Commands

### Deploy Contracts
```bash
# Deploy WarpReceiver
cd /home/madtitan/wrap-x402/wrapx402
PRIVATE_KEY=0x56289e99c94b6912bfc12adc093c9b51124f0dc54ac7a766b2bc5ccf558d8027 \
forge script script/DeployWarpReceiver.s.sol:DeployWarpReceiver \
  --rpc-url http://127.0.0.1:9650/ext/bc/2fEmFBdd2Dfjh6nmrTjGTGNbnCb86moNHvCtrdP5bJxpftSEXA/rpc \
  --broadcast

# Deploy WarpSender
PRIVATE_KEY=0x56289e99c94b6912bfc12adc093c9b51124f0dc54ac7a766b2bc5ccf558d8027 \
forge script script/DeployWarpSender.s.sol:DeployWarpSender \
  --rpc-url http://127.0.0.1:9652/ext/bc/bjoxQvUZv6FcN5SyYosFMziVyCcnbRMi2YTr2vX3rFzaYYJn/rpc \
  --broadcast

# Configure Sender
PRIVATE_KEY=0x56289e99c94b6912bfc12adc093c9b51124f0dc54ac7a766b2bc5ccf558d8027 \
SENDER_ADDRESS=0x52C84043CD9c865236f11d9Fc9F56aa003c1f922 \
RECEIVER_ADDRESS=0x52C84043CD9c865236f11d9Fc9F56aa003c1f922 \
REMOTE_BLOCKCHAIN_ID=0xda84bf13c2354aab48b684d7a177e14a91fb86bdada0e84361e30f6465f3b47b \
forge script script/ConfigureSender.s.sol:ConfigureSender \
  --rpc-url http://127.0.0.1:9652/ext/bc/bjoxQvUZv6FcN5SyYosFMziVyCcnbRMi2YTr2vX3rFzaYYJn/rpc \
  --broadcast
```

## Test Results Summary

✅ All Task 1 features tested and working:
- Payment sending with sendPayment()
- Payment verification with hasPaid()
- Receipt retrieval with getReceipt()
- Payment consumption with consumePayment()
- Double-consumption prevention
- Required payment amount validation
- Duplicate payment ID prevention
- Cross-chain message delivery via Teleporter

✅ All Task 2 features tested and working:
- ConfigureSender script execution
- Remote receiver configuration (0x52C84043CD9c865236f11d9Fc9F56aa003c1f922)
- Remote blockchain ID configuration (0xda84bf13c2354aab48b684d7a177e14a91fb86bdada0e84361e30f6465f3b47b)
- Cross-chain payment delivery with configured addresses
- Teleporter Messenger address verification (0x253b2784c75e510dD0fF1da844684a1aC0aa5fcf)




